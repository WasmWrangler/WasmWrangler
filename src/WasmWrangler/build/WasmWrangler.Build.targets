<Project>
  <Target Name="WasmBuild" AfterTargets="AfterBuild" DependsOnTargets="
    WasmInjectScripts;
    CalculateWasmOutputPath;
    WasmCallSDKPackager;
    WasmCopyAssets" />
  
  <Target Name="WasmCopyAssets">
    <ItemGroup>
      <_WasmDistFiles Include="$(WasmOutputPath)/**/*" />
      <WasmFilesToCopy Include="$(OutputPath)/**/*" Exclude="@(WasmFilesToPackage);@(_WasmDistFiles)" />

      <WasmFilesToCopy Update="*">
        <Source>%(WasmFilesToCopy.Identity)</Source>
        <Destination>$(WasmOutputPath)/%(WasmFilesToCopy.RecursiveDir)%(WasmFilesToCopy.Filename)%(WasmFilesToCopy.Extension)</Destination>
      </WasmFilesToCopy>
    </ItemGroup>

    <Message Importance="high" Text="@(WasmFilesToCopy->'%(Source) => %(Destination)', '%0A')" />
        
    <Copy
        SourceFiles="%(WasmFilesToCopy.Source)"
        DestinationFiles="%(WasmFilesToCopy.Destination)"
        SkipUnchangedFiles="true" />
  </Target>
</Project>
